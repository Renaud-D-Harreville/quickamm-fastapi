{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "An example of Cartesian layouts for a node-link diagram of hierarchical data.",
  "width": 1200,
  "height": 800,
  "padding": 15,
  "signals": [
    {
      "name": "labels",
      "value": true,
      "bind": {
        "input": "checkbox"
      }
    },
    {
      "name": "layout",
      "value": "cluster",
      "bind": {
        "input": "radio",
        "options": [
          "cluster",
          "tidy"
        ]
      }
    },
    {
      "name": "links",
      "value": "line",
      "bind": {
        "input": "select",
        "options": [
          "line",
          "curve",
          "diagonal",
          "orthogonal"
        ]
      }
    },
    {
      "name": "separation",
      "value": true,
      "bind": {
        "input": "checkbox"
      }
    }
  ],
  "data": [
    {
      "name": "tree",
      "values": [
        {
          "id": "Animalia",
          "name": "Animaux",
          "taxon": "Règne",
          "classificationDepth": 0,
          "parent": null
        },
        {
          "id": "Chordata",
          "name": "Chordés",
          "taxon": "Embranchement",
          "classificationDepth": 1,
          "parent": "Animalia"
        },
        {
          "id": "Vertebrata",
          "name": "Vertébrés",
          "taxon": "Sous-embranchement",
          "classificationDepth": 2,
          "parent": "Chordata"
        },
        {
          "id": "Mammalia",
          "name": "Mammifères",
          "taxon": "Classe",
          "classificationDepth": 3,
          "parent": "Vertebrata"
        },
        {
          "id": "Artiodactyla",
          "name": "Artiodactyles",
          "taxon": "Ordre",
          "classificationDepth": 4,
          "parent": "Mammalia"
        },
        {
          "id": "Ruminantia",
          "name": "Ruminants",
          "taxon": "Sous-ordre",
          "classificationDepth": 5,
          "parent": "Artiodactyla"
        },
        {
          "id": "Bovidae",
          "name": "Bovidés",
          "taxon": "Famille",
          "classificationDepth": 6,
          "parent": "Ruminantia"
        },
        {
          "id": "Caprinae",
          "name": "Caprinés",
          "taxon": "Sous-famille",
          "classificationDepth": 7,
          "parent": "Bovidae"
        },
        {
          "id": "Corvus",
          "name": "Corbeaux",
          "taxon": "Genre",
          "classificationDepth": 8,
          "parent": "Corvidae"
        },
        {
          "id": "Rupicapra",
          "name": "Chamois / Isard",
          "taxon": "Espèce",
          "classificationDepth": 9,
          "parent": "Caprinae"
        }
      ],
      "transform": [
        {
          "type": "stratify",
          "key": "id",
          "parentKey": "parent"
        },
        {
          "type": "tree",
          "method": {
            "signal": "layout"
          },
          "size": [
            {
              "signal": "width"
            },
            {
              "signal": "height"
            }
          ],
          "separation": {
            "signal": "separation"
          },
          "as": [
            "x",
            "y",
            "depth",
            "children"
          ]
        },
        {
          "type": "formula",
          "as": "y",
          "expr": "datum.classificationDepth * 80"
        }
      ]
    },
    {
      "name": "links",
      "source": "tree",
      "transform": [
        {
          "type": "treelinks"
        },
        {
          "type": "linkpath",
          "orient": "vertical",
          "shape": {
            "signal": "links"
          }
        }
      ]
    }
  ],
  "scales": [
    {
      "name": "color",
      "type": "ordinal",
      "range": {
        "scheme": "category10"
      },
      "domain": {
        "data": "tree",
        "field": "taxon"
      }
    }
  ],
  "marks": [
    {
      "type": "path",
      "from": {
        "data": "links"
      },
      "encode": {
        "update": {
          "path": {
            "field": "path"
          },
          "stroke": {
            "value": "#222"
          }
        }
      }
    },
    {
      "type": "symbol",
      "from": {
        "data": "tree"
      },
      "encode": {
        "enter": {
          "size": {
            "value": 400
          },
          "stroke": {
            "value": "#fff"
          }
        },
        "update": {
          "x": {
            "field": "x"
          },
          "y": {
            "field": "y"
          },
          "fill": {
            "scale": "color",
            "field": "taxon"
          }
        }
      }
    },
    {
      "type": "text",
      "from": {
        "data": "tree"
      },
      "encode": {
        "enter": {
          "text": {
            "field": "name"
          },
          "fontSize": {
            "value": 12
          },
          "baseline": {
            "value": "bottom"
          },
          "align": {
            "value": "center"
          }
        },
        "update": {
          "x": {
            "field": "x"
          },
          "y": {
            "field": "y"
          },
          "dx": {
            "signal": "datum.children ? -0 : -15"
          },
          "dy": {
            "signal": "datum.children ? -15 : 10"
          },
          "align": {
            "signal": "datum.children ? 'center' : 'right'"
          },
          "baseline": {
            "signal": "datum.children ? 'center' : 'bottom'"
          },
          "opacity": {
            "signal": "labels ? 1 : 0"
          },
          "angle": {
            "signal": "datum.children ? 0 : -55"
          }
        }
      }
    }
  ],
  "legends": [
    {
      "fill": "color",
      "title": "Classification",
      "orient": "top-left",
      "labelFontSize": 18,
      "labelLimit": 200,
      "symbolSize": 200,
      "titleFontSize": 24,
      "titleLimit": 200,
      "encode": {
        "symbols": {
          "enter": {
            "fillOpacity": {
              "value": 1
            }
          }
        },
        "labels": {
          "update": {
            "text": {
              "field": "value"
            }
          }
        }
      },
      "values": [
        "Règne",
        "Embranchement",
        "Sous-embranchement",
        "Classe",
        "Ordre",
        "Sous-ordre",
        "Famille",
        "Sous-famille",
        "Genre",
        "Espèce"
      ]
    }
  ]
}